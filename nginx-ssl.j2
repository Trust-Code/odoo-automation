server {
    listen  80;
    server_name {{ item }}.trustcode.com.br;
    rewrite ^ https://$http_host$request_uri? permanent;    # force redirect http to https
}

server {
       listen 443 ssl;
       server_name localhost {{ item }}.trustcode.com.br;
       access_log  /var/log/nginx/openerp.log;
       ssl_certificate /etc/nginx/ssl/nginx.crt;
       ssl_certificate_key /etc/nginx/ssl/nginx.key;
       location / {
                proxy_pass http://127.0.0.1:{{ odoo_port }};
                proxy_set_header Host $host;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_set_header X-Forwarded-Host $host;
                proxy_set_header X-Forwarded-Proto $scheme;
                proxy_connect_timeout   1800;
                proxy_send_timeout      1800;
                proxy_read_timeout      1800;
                send_timeout            1800;
                client_max_body_size 30M;
                gzip             on;
                gzip_comp_level  2;
                gzip_min_length  1000;
                gzip_proxied     expired no-cache no-store private auth;
                gzip_types       text/plain application/javascript text/xml text/css application/xml application/json;
       }
}
